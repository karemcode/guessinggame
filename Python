import os
import random

from flask import Flask, request

app = Flask(__name__)

secret_number = random.randint(1, 100)
attempts = 0
max_attempts = 10

@app.route("/", methods=["GET", "POST"])
def index():
    global attempts

    # Add the input line here
    user_input = input("Enter something: ") + "\n"

    if request.method == "POST":
        guess = int(request.form["guess"])
        attempts += 1

        if guess < secret_number:
            message = "Too low! Try again."
        elif guess > secret_number:
            message = "Too high! Try again."
        else:
            message = f"Congratulations! You guessed the number {secret_number} in {attempts} attempts."
    else:
        message = "Welcome to the Guess the Number game! I've chosen a number between 1 and 100. Try to guess it."

    if attempts >= max_attempts or (attempts > 0 and guess == secret_number):
        message += f" The secret number was {secret_number}."
        # Reset the game
        secret_number = random.randint(1, 100)
        attempts = 0

    return f"""
    <html>
    <head><title>Guess the Number</title></head>
    <body>
        <h1>{message}</h1>
        <form method="post">
            <label for="guess">Enter your guess: </label>
            <input type="number" id="guess" name="guess" min="1" max="100">
            <input type="submit" value="Submit">
        </form>
    </body>
    </html>
    """

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    app.run(host="0.0.0.0", port=port)
